---
layout: default
title: Traffic Management
nav_order: 1
parent: Concepts
grand_parent: Istio
---

# Traffic Management

이스티오의 트래픽 라우팅 룰은 사용자가 서비스간 API 콜과 트래픽 흐름을 쉽게 컨트롤할 수 있게 해준다. 이스티오는 써킷 브레이커, 타임아웃, 리트라이같은 서비스 레벨의 설정을 단순화하며 퍼센트 기반의 트래픽 조절을 상요한 스테이지 롤아웃, 카나리 롤아웃, A/B 테스팅 같은 중요한 작업을 쉽게 설정할 수 있게 해준다. 또한 네트워크, 서비스로 인해 발생하는 장애로부터의 탄력적이게 운용할 수 있게 해주는 즉시 적용 가능한 신뢰성 기능들을 제공한다.

이스티오의 트래픽 매니지먼트 모델은 서비스와 같이 배포되는 엔보이 프록시로부터 제공된다. 메시 서비스에서 주고 받는 모든 트래픽은 엔보이로부터 프록시되고 사용자 서비스의 별도 수정 없이도 쉽게 컨트롤할 수 있게 해준다.

만약 이 가이드에서 설명한 기능이 어떻게 동작하는지 관심있다면, 이스티오 트래픽 매니저 구현과 관련된 더 자세한 내용을 아키텍쳐 오버뷰에서 볼 수 있다. 이 가이드 나머지 부분에선 이스티오의 트래픽 매니지먼트 기능에 대해 설명한다.

## Introducing Istio traffic management

사용자의 메시안에서 트래픽을 컨트롤하기위해 이스티오는 모든 사용자의 서비스들과 그 서비스들이 가지는 엔트포인트에 대해서 알아야 한다. 서비스 레지스트리에 정보를 넣기 위해 이스티오는 서비스 디스커버리 시스템에 접속한다. 예를들어 만약 사용자가 이스티오를 쿠버네티스 클러스터에 설치했다면 이스티오는 클러스터내의 엔드포인트와 서비스들을 자동으로 감지한다.

서비스 레지시트리를 사용해서 엔보이는 관련 서비스로 트래픽을 전달한다. 대부분의 마이크로서비스 기반 애플리케이션은 서비스 트래픽을 핸들링하거나 또는 로드벨런싱등을 위해 개별 워크로드의 멀티 인스턴스를 가진다. 엔보이 프록시는 기본적으로 최소 요청 모델을 사용해서 서비스의 로드밸런싱 풀에 트래픽을 분산한다. 풀에 투 호스트가 랜덤으로 선택되어 더 적은 액티브 요청을 가지는 호스트로 라우팅된다. in this way the most heavily loaded host will not receive requests until it is no more loaded than any other host.

이스티오의 기본 서비스 디스커버리와 로드벨런싱은 서비스 메시를 가능하게 하지만 이것이 다는 아니다. 대부분의 사용자는 메시의 트레픽을 더 세밀하게 제어하고 싶어 한다. 사용자는 새로운 버전의 A/B 테스팅을 위해 트래픽을 특정 퍼센테이지로 지정하거나 또는 전체 서비스 인스턴스 중 특정 인스턴스들의 트래픽에 대한 특별한 로드벨런싱 룰을 적용하거나 등을 원할 수 있다. 이스티오는 이런 기능들을 트래픽 매니지먼트 API에서 트래픽 설정을 통하여 제공한다.

다른 이스티오 설정과 같이, yaml로 설정하는 쿠버네티스 커스텀 리소스 정의(CRDs)로 지정할 수 있다.

이 가이드의 남은 부분은 아래 나열된 트래픽 매니지먼트 API 리소스들을 설명하고 어떻게 하는지 알아본다.

* Virtual services
* Destination rules
* Gateways
* Service entires
* Sidecars

이 가이드는 API 리소스에 포함되어있는 또한 네트워크 탄력성과 테스팅 기능도 살펴본다.

## Virtual services

버츄얼 서비스는 데스티네이션 룰과 함께 이스티오의 트래픽 라우팅 기능의 핵심이다. 버츄얼 서비스는 이스티오와 플랫폼에의해 제공되는 기본 연결 및 검색을 기반으로 리퀘스트를 이스티오 서비스 메시에 속해있는 서비스에 어떻게 라우트할지 설정할 수 있도록 제공한다. 개별 버츄얼 서비스는 우선순위를 가지는 여러 라우팅 룰들의 집합이고 이스티오는 가상 서비스로의 요청을 메시상의 실제 목적지와 매칭시킨다. 사용자의 메시에따라 여러개의 버츄얼 서비스가 필요할수도, 필요없을수도 있다.

### Why use virtual services?

버츄얼 서비스는 이스티오의 트래픽 매니지먼트를 유연하고 강력하게 만들어주는 핵심 기능이다. 실제 구현된 목적지의 워크로드를 클라이언트가 전송하는 리퀘스트로부터 강력하게 디커플링한다. 또한 워크로드로 트래픽을 전송하기 위한 다양한 트래픽 라우팅 룰을 정의하는 다양한 방법을 제공한다.

왜 이것이 유용할까? 버츄얼 서비스가 없다면 엔보이는 최소 요청 방식 로드밸런싱 방식을 상요한 트래픽 분산을 모든 서비스 인스턴스를 대상으로 수행한다. You can improve this behavior with what you know about the workloads. 예를들어 일부 서비스 인스턴스는 다른 버전일 수 있다. 이럴 경우, A/B 테스팅 상황에서 다른 서비스 버전으로 가는 트래픽을 퍼센트 기반의 설정으로 라우팅을 조절하거나 또는 내부 유저들은 특정 인스턴스들에게 트래픽을 받을 수 있도록 할 수 있다.

버츄얼 서비스를 통해 트래픽을 받을 호스트이름을 지정할 수 도 있다. 버츄얼 서비스에서 제공하고는 라우팅 룰을 사용해서 엔보이에게 버츄얼 서비스의 트래픽을 적절한 목적지에 전송하도록 설정할 수 있다. 라우팅 목적지는 전혀 다른 서비스이거나 또는 같은 서비스의 다른 버전이 될 수도 있다.